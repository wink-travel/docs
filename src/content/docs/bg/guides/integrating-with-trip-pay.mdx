---
title: Интегриране с TripPay
description: >-
  Тази статия съдържа пълен пример за това как да се интегрирате с TripPay и да
  позволите на плащането да се извърши вместо вас.
sidebar:
  order: 4
---
import { Steps } from '@astrojs/starlight/components';

Тази статия съдържа подробен пример за това как да се интегрирате с TripPay.

Препоръчително е вече да сте прочели:

* [Плащане > Картографиране](/payment/mapping).
* [Плащане > Интеграция](/payment/integration).
* [Уеб компонент за плащане](/developers/web-components/#payment).
* [API за плащане](/developers/apis/#payment-api).*Прочетете раздела за`Create payable contracts`*

Ето стъпките за успешно използване на TripPay за плащане на резервация:

<Steps>
  1. Уверете се, че бенефициентите, които споменавате в договора за резервация, са картографирани.
  2. Нека пътникът избере инвентара, който иска да резервира, и го подгответе да плати.
  3. Създайте `payable contract` с TripPay, който съдържа артикулите за резервация.
  4. Нека пътникът плати, използвайки уеб компонента на TripPay.
</Steps>


Предполагаме, че вече сте завършили`Step 1`и`Step 2`и са готови да уведомят TripPay за резервацията.

## Създаване на договор за плащане

:::note
Отидете на API за плащане, за да научите повече за изискванията за създаване на платим договор.
:::

### Заявка

Ето примерна JSON заявка, която включва всичко необходимо за създаването на първия ви платим договор.

```json {3-6, 8-9}
{
  "user": {
    "userIdentifier": "191d5729-0b90-4000-85df-1bea7a6e9a01",
    "firstName": "John",
    "lastName": "Smith",
    "email": "john.smith@email.com"
  },
  "affiliateAccountIdentifier": "291d5729-0b91-4001-95df-2bec7a6e9a01",
  "affiliateAccountIdentifierType": "INTERNAL",
  "displayCurrency": "USD",
  "traceId": "trace-1",
  "redirectUrl": "/thank-you",
  "sourceUrl": "https://www.travel.com",
  "contractList": [
    {
      "identifier": "191d5729-0b90-4000-8298-72431beb1701",
      "supplierIdentifier": "191d5729-0b90-4000-8b72-58186a642401",
      "supplierIdentifierType": "EXTERNAL",
      "contractItemList": [
        {
          "user": {
            "userIdentifier": "191d5729-0b90-4000-8596-ed18f9876801",
            "firstName": "John",
            "lastName": "Smith",
            "email": "john.smith@email.com",
            "telephone": "+1 212 555 1212",
          },
          "nameInEnglish": "Deluxe King",
          "descriptionInEnglish": "This is the best deluxe king that money can buy.",
          "price": {
            "amount": 100,
            "currency": "USD"
          },
          "itinerary": {
            "startDate": "2024-12-24T00:00:00.000Z",
            "endDate": "2024-12-25T00:00:00.000Z",
            "adults": 2
          },
          "pricingType": "PER_STAY",
          "type": "LODGING",
          "payable": "PREPAY",
          "policy": {
            "refundable": true
          },
          "externalIdentifier": "room-type-1",
          "dailyRateList": [
            {
              "date": "2024-12-24",
              "price": {
                "amount": 100,
                "currency": "USD"
              }
            }
          ],
          "beneficiaryList": [
            {
              "identifier": "account-0",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.015
              },
              "type": "PLATFORM_FEE"
            },
            {
              "identifier": "account-1",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.0985
              },
              "type": "COMMISSION"
            },
            {
              "identifier": "account-2",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.8865
              },
              "type": "SALE"
            }
          ]
        }
      ]
    }
  ]
}
```

Обяснение:

Няма да обясняваме всяка точка от данните тук, тъй като те вече са разгледани в документацията на API.

* Линии:**2 - 7**е потребителят, отговорен за резервацията. Има два вида резервиращи:
  * Пътешественик.
  * Туристически агент.
* Линии:**8 - 9**е акаунтът в TripPay, който улеснява резервацията. Той може да бъде:
  * Вашият акаунт за интеграция на TripPay.
  * Ако управлявате партньорска мрежа, тя може да бъде вашият партньор.
* Използвайте`traceId`да групирате множество резервации при множество доставчици. По този начин можете да отмените групова резервация.
* `redirectUrl`уведомява TripPay към коя страница да пренасочи, след като плащането е завършено.
* `sourceUrl`е сайтът/приложението, на което е извършена резервацията.

The`contractList`Масивът съдържа артикула(ите), които пътникът иска да закупи от няколко доставчици. Всеки артикул съдържа:

* The`identifier`е валиден UUID, който генерирате.
* Доставчикът, от когото искате да резервирате инвентар.
* Инвентарът, който искате да резервирате от този доставчик. Всички те са посочени във вложения масив.`contractItemList`.
* Всеки запис под`contractItemList`съдържа:
  * **Гост потребител**Това е потребителят, който ще пристигне на място.
  * **Име на английски**Името на инвентара на английски език.
  * **Описание на английски език**По-дълго описание на инвентара на английски език.
  * **Цена**Цената на артикула.
  * **Маршрут**Кога този артикул трябва да бъде резервиран.
  * **Вид ценообразуване**Как е била изчислена цената.
  * **Тип инвентар**Какъв вид инвентар е това.
  * **Платимо**Кога пътникът трябва да бъде таксуван.*В момента поддържаме само опции за незабавно плащане.*
  * **Политика**Включете правила за политика за анулиране.
  * **Дневен списък с цени**Ако резервираният артикул е стая, можете да изберете да включите цената на стаята за всяка нощувка, в която гостът пребивава.
  * **Бенефициенти**Включете на кой(и) TripPay акаунт(и) да бъде разпределена каква(и) сума(и) от цената на артикула.*Поддържат се фиксирани/процентни суми.*

:::note
В горния JSON пример имаме 3 бенефициента:

* 1,5% бяха разпределени на платформата, която улесни резервацията.*напр. Намигване*
* 9,85% бяха разпределени на партньора като комисионна.*например Ким Кардашиян*
* 88,65% бяха разпределени на доставчика за резервацията на стаята.*напр. Хилтън*

Когато TripPay отговори с платим договор, ще забележите, че е инжектирал собствен бенефициент с лихва от 4,0%. :::

### Отговор

Когато TripPay отговори на вашата заявка, тя ще изглежда по следния начин:

```json {3}
[
  {
    "id": "contract-1",
    "traceId": "trace-1",
    "supplierContractIdentifier": "191d5729-0b90-4000-8298-72431beb1701",
    "supplierIdentifier": "191d5729-0b90-4000-8b72-58186a642401",
    "supplierName": "Hilton",
    "totalPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalDisplayPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalSupplierPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalInternalPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalCapturePrice": {
      "amount": 100,
      "currency": "USD"
    }
  }
]
```

Запазете`id`на ред 3. Ще използвате това, за да инжектирате в уеб компонента на TripPay.

## Вграждане на TripPay

:::note
Уверете се, че сте заредили нашите стилове и Javascript предварително. :::

В този момент сте готови да вградите`Payment Web Component`във вашия уебсайт и го покажете на потребителя.

```html
<trip-pay id="contract-1"></trip-pay>
```

Що се отнася до интеграцията, това е всичко, което трябва да направите. Цялата тежка работа се извършва от TripPay оттук нататък.

