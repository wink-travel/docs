---
title: Samþætting við TripPay
description: Þessi grein inniheldur fullkomið dæmi um hvernig á að samþætta við og láta TripPay sjá um greiðsluna fyrir þig.
sidebar:
  order: 4
---

import { Steps } from '@astrojs/starlight/components';

Þessi grein inniheldur dæmi frá upphafi til enda um hvernig á að samþætta við TripPay.

Mælt er með að þú hafir þegar lesið:

- [Payment > Mapping](/is/payment/mapping).
- [Payment > Integration](/is/payment/integration).
- [Payment Web Component](/is/developers/web-components/#payment).
- [Payment API](/is/developers/apis/#payment-api). *Lestu kaflann um `Create payable contracts`*

Hér eru skrefin til að nota TripPay til að greiða fyrir bókun með góðum árangri:

<Steps>
1. Gakktu úr skugga um að þeir sem þú nefnir sem þiggjendur í bókunarsamningnum hafi verið kortlagðir.
2. Láttu ferðalanginn velja birgðirnar sem hann vill bóka og undirbúa sig til að greiða.
3. Búðu til `payable contract` með TripPay sem inniheldur þá hluti sem á að bóka.
4. Láttu ferðalanginn greiða með TripPay Web Component.
</Steps>

Við gerum ráð fyrir að þú hafir þegar lokið `Skrefi 1` og `Skrefi 2` og ert tilbúinn að láta TripPay vita af bókuninni.

## Búa til greiðslusamning

:::note
Farðu á Payment API til að læra meira um kröfurnar til að búa til greiðslusamning.
:::

### Fyrirspurn
Hér er JSON dæmi um fyrirspurn sem inniheldur allt sem þú þarft til að búa til þinn fyrsta greiðslusamning.

```json {3-6, 8-9}
{
  "user": {
    "userIdentifier": "191d5729-0b90-4000-85df-1bea7a6e9a01",
    "firstName": "John",
    "lastName": "Smith",
    "email": "john.smith@email.com"
  },
  "affiliateAccountIdentifier": "291d5729-0b91-4001-95df-2bec7a6e9a01",
  "affiliateAccountIdentifierType": "INTERNAL",
  "displayCurrency": "USD",
  "traceId": "trace-1",
  "redirectUrl": "/thank-you",
  "sourceUrl": "https://www.travel.com",
  "contractList": [
    {
      "identifier": "191d5729-0b90-4000-8298-72431beb1701",
      "supplierIdentifier": "191d5729-0b90-4000-8b72-58186a642401",
      "supplierIdentifierType": "EXTERNAL",
      "contractItemList": [
        {
          "user": {
            "userIdentifier": "191d5729-0b90-4000-8596-ed18f9876801",
            "firstName": "John",
            "lastName": "Smith",
            "email": "john.smith@email.com",
            "telephone": "+1 212 555 1212",
          },
          "nameInEnglish": "Deluxe King",
          "descriptionInEnglish": "This is the best deluxe king that money can buy.",
          "price": {
            "amount": 100,
            "currency": "USD"
          },
          "itinerary": {
            "startDate": "2024-12-24T00:00:00.000Z",
            "endDate": "2024-12-25T00:00:00.000Z",
            "adults": 2
          },
          "pricingType": "PER_STAY",
          "type": "LODGING",
          "payable": "PREPAY",
          "policy": {
            "refundable": true
          },
          "externalIdentifier": "room-type-1",
          "dailyRateList": [
            {
              "date": "2024-12-24",
              "price": {
                "amount": 100,
                "currency": "USD"
              }
            }
          ],
          "beneficiaryList": [
            {
              "identifier": "account-0",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.015
              },
              "type": "PLATFORM_FEE"
            },
            {
              "identifier": "account-1",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.0985
              },
              "type": "COMMISSION"
            },
            {
              "identifier": "account-2",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.8865
              },
              "type": "SALE"
            }
          ]
        }
      ]
    }
  ]
}
```

Útskýring:

Við munum ekki útskýra hvert gagnapunkt hér þar sem þau eru þegar útskýrð í API skjölunum.

- Línur: **2 - 7** eru notandinn sem ber ábyrgð á bókuninni. Það eru tveir gerðir bókenda:
    - Ferðalangur.
    - Ferðaskrifstofumaður.
- Línur: **8 - 9** eru TripPay reikningurinn sem sér um bókunina. Hann getur verið:
    - Þinn TripPay samþættingarreikningur.
    - Ef þú rekur tengdanet, getur það verið tengdiliður þinn.
- Notaðu `traceId` til að hópa saman margar bókanir frá mörgum birgjum. Þannig getur þú hætt við hópbókun.
- `redirectUrl` segir TripPay hvaða síðu á að vísa á eftir að greiðslan er lokið.
- `sourceUrl` er vefsvæðið / appið þar sem bókunin átti sér stað.

Fylkið `contractList` inniheldur þann hlut eða þá hluti sem ferðalangurinn vill kaupa frá mörgum birgjum. Hver hlutur inniheldur:

- `identifier` er gilt UUID sem þú býrð til.
- Birginn sem þú vilt bóka birgðir frá.
- Birgðirnar sem þú vilt bóka frá þeim birgi. Þær eru allar tilgreindar í innra fylkinu `contractItemList`.
- Hver færsla undir `contractItemList` inniheldur:
    - **Gestanotandi** Þetta er notandinn sem mun koma á staðinn.
    - **Nafn á ensku** Nafn birgðarinnar á ensku.
    - **Lýsing á ensku** Lengri lýsing á birgðinni á ensku.
    - **Verð** Verð hlutarins.
    - **Ferðaáætlun** Hvenær á að bóka þennan hlut.
    - **Tegund verðlagningar** Hvernig verðið var reiknað.
    - **Tegund birgða** Hvaða tegund birgða þetta er.
    - **Greiðsluskyldur** Hvenær ferðalangurinn á að greiða. *Við styðjum nú aðeins tafarlausar greiðslumöguleika.*
    - **Stefna** Inniheldur reglur um afpöntun.
    - **Dagsverðlisti** Ef hluturinn sem er bókaður er herbergi, getur þú valið að taka með hversu mikið herbergið kostar fyrir hverja nótt sem gesturinn dvelur.
    - **Þiggjendur** Inniheldur hvaða TripPay reikning(ur) eiga að fá hvaða hluta af verði hlutarins. *Fastar / prósentu upphæðir eru studdar.*

:::note
Í ofangreindu JSON dæmi eru 3 þiggjendur:

- 1,5% var úthlutað til vettvangsins sem sá um bókunina. *t.d. Wink*
- 9,85% var úthlutað tengdiliðnum sem þóknun. *t.d. Kim Kardashian*
- 88,65% var úthlutað birgjanum fyrir bókun herbergisins. *t.d. Hilton*

Þegar TripPay svarar með greiðslusamningi, munt þú taka eftir að það setti inn sinn eigin þiggjanda með 4,0%.
:::

### Svar

Þegar TripPay svarar fyrirspurn þinni mun það líta út svona:

```json {3}
[
  {
    "id": "contract-1",
    "traceId": "trace-1",
    "supplierContractIdentifier": "191d5729-0b90-4000-8298-72431beb1701",
    "supplierIdentifier": "191d5729-0b90-4000-8b72-58186a642401",
    "supplierName": "Hilton",
    "totalPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalDisplayPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalSupplierPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalInternalPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalCapturePrice": {
      "amount": 100,
      "currency": "USD"
    }
  }
]
```

Vistaðu `id` á línu 3. Þú munt nota það til að setja inn í TripPay vefhlutann.

## Innbyggja TripPay

:::note
Gakktu úr skugga um að þú hafir hlaðið inn stílum og Javascript áður.
:::

Á þessum tímapunkti ertu tilbúinn að innbyggja `Payment Web Component` á vefsíðuna þína og sýna notandanum.

```html
<trip-pay id="contract-1"></trip-pay>
```

Varðandi samþættingu, þá er þetta allt sem þú þarft að gera. Allt þungt verk er unnið af TripPay héðan í frá.
