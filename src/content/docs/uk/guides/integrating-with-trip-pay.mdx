---
title: Інтеграція з TripPay
description: >-
  Ця стаття містить повний приклад того, як інтегруватися з TripPay та дозволити
  йому обробити платіж за вас.
sidebar:
  order: 4
---
import { Steps } from '@astrojs/starlight/components';

Ця стаття містить повний приклад інтеграції з TripPay.

Рекомендується, щоб ви вже прочитали:

* [Оплата > Зіставлення](/payment/mapping).
* [Оплата > Інтеграція](/payment/integration).
* [Веб-компонент оплати](/developers/web-components/#payment).
* [API оплати](/developers/apis/#payment-api).*Прочитайте розділ про`Create payable contracts`*

Ось кроки для успішного використання TripPay для оплати бронювання:

<Steps>
  1. Переконайтеся, що бенефіціарів, яких ви згадуєте в договорі бронювання, було зіставлено.
  2. Нехай мандрівник вибере потрібний йому інвентар і приготується до оплати.
  3. Створити `payable contract` за допомогою TripPay, який містить елементи для бронювання.
  4. Дозвольте мандрівнику сплатити за допомогою веб-компонента TripPay.
</Steps>


Ми вважаємо, що ви вже завершили`Step 1`і`Step 2`і готові повідомити TripPay про бронювання.

## Створити договір про сплату

:::note
Перейдіть до API платежів, щоб дізнатися більше про вимоги до створення договору з оплатою.
:::

### Запит

Ось зразок JSON-запиту, який містить усе необхідне для створення вашого першого платіжного контракту.

```json {3-6, 8-9}
{
  "user": {
    "userIdentifier": "191d5729-0b90-4000-85df-1bea7a6e9a01",
    "firstName": "John",
    "lastName": "Smith",
    "email": "john.smith@email.com"
  },
  "affiliateAccountIdentifier": "291d5729-0b91-4001-95df-2bec7a6e9a01",
  "affiliateAccountIdentifierType": "INTERNAL",
  "displayCurrency": "USD",
  "traceId": "trace-1",
  "redirectUrl": "/thank-you",
  "sourceUrl": "https://www.travel.com",
  "contractList": [
    {
      "identifier": "191d5729-0b90-4000-8298-72431beb1701",
      "supplierIdentifier": "191d5729-0b90-4000-8b72-58186a642401",
      "supplierIdentifierType": "EXTERNAL",
      "contractItemList": [
        {
          "user": {
            "userIdentifier": "191d5729-0b90-4000-8596-ed18f9876801",
            "firstName": "John",
            "lastName": "Smith",
            "email": "john.smith@email.com",
            "telephone": "+1 212 555 1212",
          },
          "nameInEnglish": "Deluxe King",
          "descriptionInEnglish": "This is the best deluxe king that money can buy.",
          "price": {
            "amount": 100,
            "currency": "USD"
          },
          "itinerary": {
            "startDate": "2024-12-24T00:00:00.000Z",
            "endDate": "2024-12-25T00:00:00.000Z",
            "adults": 2
          },
          "pricingType": "PER_STAY",
          "type": "LODGING",
          "payable": "PREPAY",
          "policy": {
            "refundable": true
          },
          "externalIdentifier": "room-type-1",
          "dailyRateList": [
            {
              "date": "2024-12-24",
              "price": {
                "amount": 100,
                "currency": "USD"
              }
            }
          ],
          "beneficiaryList": [
            {
              "identifier": "account-0",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.015
              },
              "type": "PLATFORM_FEE"
            },
            {
              "identifier": "account-1",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.0985
              },
              "type": "COMMISSION"
            },
            {
              "identifier": "account-2",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.8865
              },
              "type": "SALE"
            }
          ]
        }
      ]
    }
  ]
}
```

Пояснення:

Ми не будемо пояснювати тут кожну точку даних, оскільки вони вже розглянуті в документації API.

* Лінії:**2 - 7**користувач, відповідальний за бронювання. Існує два типи тих, хто бронює:
  * Мандрівник.
  * Туристичний агент.
* Лінії:**8 - 9**це обліковий запис TripPay, який полегшує бронювання. Це може бути:
  * Ваш обліковий запис інтегратора TripPay.
  * Якщо ви керуєте партнерською мережею, вона може бути вашим партнером.
* Використовуйте`traceId`щоб згрупувати кілька бронювань у кількох постачальників. Таким чином, ви можете скасувати групове бронювання.
* `redirectUrl`повідомляє TripPay, на яку сторінку перенаправляти після завершення оплати.
* `sourceUrl`це сайт/додаток, на якому відбулося бронювання.

The`contractList`Масив містить товари, які мандрівник хоче придбати у кількох постачальників. Кожен товар містить:

* The`identifier`– це дійсний UUID, який ви генеруєте.
* Постачальник, у якого ви хочете забронювати товар.
* Інвентар, який ви хочете забронювати у цього постачальника. Усі вони вказані у вкладеному масиві.`contractItemList`.
* Кожен запис у розділі`contractItemList`містить:
  * **Гість**Це користувач, який прибуде на територію.
  * **Ім'я англійською мовою**Назва інвентаризації англійською мовою.
  * **Опис англійською мовою**Докладніший опис інвентарю англійською мовою.
  * **Ціна**Ціна товару.
  * **Маршрут**Коли цей товар слід бронювати.
  * **Тип ціноутворення**Як розраховувалася ціна.
  * **Тип інвентарю**Що це за тип інвентарю.
  * **До сплати**Коли з мандрівника слід стягувати плату.*Наразі ми підтримуємо лише варіанти негайної оплати.*
  * **Політика**Включіть правила політики скасування.
  * **Список щоденних тарифів**Якщо бронюється номер, ви можете включити вартість номера за кожну ніч перебування гостя.
  * **Бенефіціари**Вкажіть, на який(і) рахунок(и) TripPay слід виділити яку(і) суму(и) від ціни товару.*Підтримуються фіксовані/відсоткові суми.*

:::note
У наведеному вище прикладі JSON у нас є 3 бенефіціари:

* 1,5% було виділено платформі, яка сприяла бронюванню.*наприклад, підморгування*
* Партнеру було виділено 9,85% як комісія.*наприклад, Кім Кардаш'ян*
* 88,65% було виділено постачальнику для бронювання номера.*наприклад, Хілтон*

Коли TripPay надішле вам контракт на оплату, ви помітите, що він ввів власного бенефіціара під 4,0%. :::

### Відповідь

Коли TripPay відповість на ваш запит, це виглядатиме приблизно так:

```json {3}
[
  {
    "id": "contract-1",
    "traceId": "trace-1",
    "supplierContractIdentifier": "191d5729-0b90-4000-8298-72431beb1701",
    "supplierIdentifier": "191d5729-0b90-4000-8b72-58186a642401",
    "supplierName": "Hilton",
    "totalPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalDisplayPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalSupplierPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalInternalPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalCapturePrice": {
      "amount": 100,
      "currency": "USD"
    }
  }
]
```

Зберегти`id`у рядку 3. Ви будете використовувати це для вставки у веб-компонент TripPay.

## Вбудувати TripPay

:::note
Переконайтеся, що ви заздалегідь завантажили наші стилі та Javascript.
:::

На цьому етапі ви готові вбудувати`Payment Web Component`на ваш веб-сайт та покажіть його користувачеві.

```html
<trip-pay id="contract-1"></trip-pay>
```

Що стосується інтеграції, то це все, що вам потрібно зробити. Всю важку роботу відтепер виконує TripPay.

