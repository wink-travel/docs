---
title: Integracja z TripPay
description: Ten artykuł zawiera pełny przykład integracji z TripPay i umożliwienia mu obsługi płatności za Ciebie.
sidebar:
  order: 4
---

import { Steps } from '@astrojs/starlight/components';

Ten artykuł zawiera kompleksowy przykład integracji z TripPay.

Zalecamy, abyś wcześniej zapoznał się z:

- [Płatności > Mapowanie](/pl/payment/mapping).
- [Płatności > Integracja](/pl/payment/integration).
- [Payment Web Component](/pl/developers/web-components/#payment).
- [Payment API](/pl/developers/apis/#payment-api). *Przeczytaj sekcję o `Create payable contracts`*

Oto kroki, aby pomyślnie użyć TripPay do zapłaty za rezerwację:

<Steps>
1. Upewnij się, że beneficjenci, których wymieniasz w kontrakcie rezerwacyjnym, zostali zmapowani.
2. Pozwól podróżnemu wybrać inwentarz, który chce zarezerwować i przygotuj go do płatności.
3. Utwórz `payable contract` z TripPay, który zawiera elementy do zarezerwowania.
4. Pozwól podróżnemu zapłacić za pomocą TripPay Web Component.
</Steps>

Zakładamy, że ukończyłeś już `Krok 1` i `Krok 2` i jesteś gotowy, aby poinformować TripPay o rezerwacji.

## Utwórz payable contract

:::note
Przejdź do Payment API, aby dowiedzieć się więcej o wymaganiach dotyczących tworzenia payable contract.
:::

### Żądanie
Oto przykładowe żądanie JSON, które zawiera wszystko, co potrzebne do utworzenia pierwszego payable contract.

```json {3-6, 8-9}
{
  "user": {
    "userIdentifier": "191d5729-0b90-4000-85df-1bea7a6e9a01",
    "firstName": "John",
    "lastName": "Smith",
    "email": "john.smith@email.com"
  },
  "affiliateAccountIdentifier": "291d5729-0b91-4001-95df-2bec7a6e9a01",
  "affiliateAccountIdentifierType": "INTERNAL",
  "displayCurrency": "USD",
  "traceId": "trace-1",
  "redirectUrl": "/thank-you",
  "sourceUrl": "https://www.travel.com",
  "contractList": [
    {
      "identifier": "191d5729-0b90-4000-8298-72431beb1701",
      "supplierIdentifier": "191d5729-0b90-4000-8b72-58186a642401",
      "supplierIdentifierType": "EXTERNAL",
      "contractItemList": [
        {
          "user": {
            "userIdentifier": "191d5729-0b90-4000-8596-ed18f9876801",
            "firstName": "John",
            "lastName": "Smith",
            "email": "john.smith@email.com",
            "telephone": "+1 212 555 1212",
          },
          "nameInEnglish": "Deluxe King",
          "descriptionInEnglish": "This is the best deluxe king that money can buy.",
          "price": {
            "amount": 100,
            "currency": "USD"
          },
          "itinerary": {
            "startDate": "2024-12-24T00:00:00.000Z",
            "endDate": "2024-12-25T00:00:00.000Z",
            "adults": 2
          },
          "pricingType": "PER_STAY",
          "type": "LODGING",
          "payable": "PREPAY",
          "policy": {
            "refundable": true
          },
          "externalIdentifier": "room-type-1",
          "dailyRateList": [
            {
              "date": "2024-12-24",
              "price": {
                "amount": 100,
                "currency": "USD"
              }
            }
          ],
          "beneficiaryList": [
            {
              "identifier": "account-0",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.015
              },
              "type": "PLATFORM_FEE"
            },
            {
              "identifier": "account-1",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.0985
              },
              "type": "COMMISSION"
            },
            {
              "identifier": "account-2",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.8865
              },
              "type": "SALE"
            }
          ]
        }
      ]
    }
  ]
}
```

Wyjaśnienie:

Nie będziemy tłumaczyć każdego punktu danych, ponieważ są one już omówione w dokumentacji API.

- Linie: **2 - 7** to użytkownik odpowiedzialny za rezerwację. Istnieją dwa typy rezerwujących:
    - Podróżny.
    - Agent turystyczny.
- Linie: **8 - 9** to konto TripPay obsługujące rezerwację. Może to być:
    - Twoje konto integratora TripPay.
    - Jeśli prowadzisz sieć afiliacyjną, może to być Twój afiliant.
- Użyj `traceId`, aby grupować wiele rezerwacji u różnych dostawców. Dzięki temu możesz anulować rezerwację grupową.
- `redirectUrl` informuje TripPay, na którą stronę przekierować po zakończeniu płatności.
- `sourceUrl` to strona / aplikacja, na której dokonano rezerwacji.

Tablica `contractList` zawiera element(y), które podróżny chce zakupić od wielu dostawców. Każdy element zawiera:

- `identifier` to ważny UUID, który generujesz.
- Dostawcę, od którego chcesz zarezerwować inwentarz.
- Inwentarz, który chcesz zarezerwować u tego dostawcy. Wszystko to jest określone w zagnieżdżonej tablicy `contractItemList`.
- Każdy wpis w `contractItemList` zawiera:
    - **Użytkownik gościa** To użytkownik, który pojawi się na miejscu.
    - **Nazwa w języku angielskim** Nazwa inwentarza w języku angielskim.
    - **Opis w języku angielskim** Dłuższy opis inwentarza w języku angielskim.
    - **Cena** Cena elementu.
    - **Plan podróży** Kiedy ten element powinien zostać zarezerwowany.
    - **Typ wyceny** Jak obliczono cenę.
    - **Typ inwentarza** Jaki to typ inwentarza.
    - **Płatność** Kiedy podróżny powinien zostać obciążony. *Obecnie obsługujemy tylko opcje natychmiastowej płatności.*
    - **Polityka** Zawiera zasady anulowania.
    - **Lista stawek dziennych** Jeśli rezerwowany element to pokój, możesz dołączyć koszt pokoju za każdą noc pobytu gościa.
    - **Beneficjenci** Zawiera, które konto(y) TripPay powinny otrzymać jaką część ceny elementu. *Obsługiwane są kwoty stałe / procentowe.*

:::note
W powyższym przykładzie JSON mamy 3 beneficjentów:

- 1,5% zostało przydzielone platformie, która ułatwiła rezerwację. *np. Wink*
- 9,85% zostało przydzielone afiliantowi jako prowizja. *np. Kim Kardashian*
- 88,65% zostało przydzielone dostawcy za rezerwację pokoju. *np. Hilton*

Gdy TripPay odpowie payable contract, zauważysz, że dodał własnego beneficjenta na poziomie 4,0%.
:::

### Odpowiedź

Gdy TripPay odpowie na Twoje żądanie, będzie to wyglądać mniej więcej tak:

```json {3}
[
  {
    "id": "contract-1",
    "traceId": "trace-1",
    "supplierContractIdentifier": "191d5729-0b90-4000-8298-72431beb1701",
    "supplierIdentifier": "191d5729-0b90-4000-8b72-58186a642401",
    "supplierName": "Hilton",
    "totalPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalDisplayPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalSupplierPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalInternalPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalCapturePrice": {
      "amount": 100,
      "currency": "USD"
    }
  }
]
```

Zapisz `id` z linii 3. Użyjesz go do wstrzyknięcia do TripPay web component.

## Osadź TripPay

:::note
Upewnij się, że wcześniej załadowałeś nasze style i Javascript.
:::

W tym momencie jesteś gotowy, aby osadzić `Payment Web Component` na swojej stronie i pokazać go użytkownikowi.

```html
<trip-pay id="contract-1"></trip-pay>
```

Jeśli chodzi o integrację, to wszystko, co musisz zrobić. Cała ciężka praca jest wykonywana przez TripPay od tego momentu.
