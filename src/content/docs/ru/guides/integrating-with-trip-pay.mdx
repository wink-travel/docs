---
title: Интеграция с TripPay
description: >-
  В этой статье содержится полный пример того, как интегрироваться с TripPay и
  позволить ему обрабатывать платежи за вас.
sidebar:
  order: 4
---
import { Steps } from '@astrojs/starlight/components';

В этой статье содержится подробный пример интеграции с TripPay.

Рекомендуется, чтобы вы уже прочитали:

* [Оплата > Картографирование](/payment/mapping).
* [Оплата > Интеграция](/payment/integration).
* [Платежный веб-компонент](/developers/web-components/#payment).
* [API-интерфейс для платежей](/developers/apis/#payment-api).*Прочитайте раздел`Create payable contracts`*

Вот шаги для успешного использования TripPay для оплаты бронирования:

<Steps>
  1. Убедитесь, что бенефициары, которых вы упоминаете в договоре бронирования, указаны на карте.
  2. Позвольте путешественнику выбрать, какие услуги он хочет забронировать, и приготовьтесь к оплате.
  3. Создать `payable contract` с TripPay, содержащим пункты, которые необходимо забронировать.
  4. Позвольте путешественнику расплачиваться с помощью веб-компонента TripPay.
</Steps>


Мы предполагаем, что вы уже завершили`Step 1` и `Step 2`и готовы сообщить TripPay о бронировании.

## Создать оплачиваемый контракт

:::note
Перейдите в API платежей, чтобы узнать больше о требованиях для создания оплачиваемого контракта.
:::

### Запрос

Ниже приведен пример запроса JSON, который включает в себя все необходимое для создания вашего первого платежного контракта.

```json {3-6, 8-9}
{
  "user": {
    "userIdentifier": "191d5729-0b90-4000-85df-1bea7a6e9a01",
    "firstName": "John",
    "lastName": "Smith",
    "email": "john.smith@email.com"
  },
  "affiliateAccountIdentifier": "291d5729-0b91-4001-95df-2bec7a6e9a01",
  "affiliateAccountIdentifierType": "INTERNAL",
  "displayCurrency": "USD",
  "traceId": "trace-1",
  "redirectUrl": "/thank-you",
  "sourceUrl": "https://www.travel.com",
  "contractList": [
    {
      "identifier": "191d5729-0b90-4000-8298-72431beb1701",
      "supplierIdentifier": "191d5729-0b90-4000-8b72-58186a642401",
      "supplierIdentifierType": "EXTERNAL",
      "contractItemList": [
        {
          "user": {
            "userIdentifier": "191d5729-0b90-4000-8596-ed18f9876801",
            "firstName": "John",
            "lastName": "Smith",
            "email": "john.smith@email.com",
            "telephone": "+1 212 555 1212",
          },
          "nameInEnglish": "Deluxe King",
          "descriptionInEnglish": "This is the best deluxe king that money can buy.",
          "price": {
            "amount": 100,
            "currency": "USD"
          },
          "itinerary": {
            "startDate": "2024-12-24T00:00:00.000Z",
            "endDate": "2024-12-25T00:00:00.000Z",
            "adults": 2
          },
          "pricingType": "PER_STAY",
          "type": "LODGING",
          "payable": "PREPAY",
          "policy": {
            "refundable": true
          },
          "externalIdentifier": "room-type-1",
          "dailyRateList": [
            {
              "date": "2024-12-24",
              "price": {
                "amount": 100,
                "currency": "USD"
              }
            }
          ],
          "beneficiaryList": [
            {
              "identifier": "account-0",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.015
              },
              "type": "PLATFORM_FEE"
            },
            {
              "identifier": "account-1",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.0985
              },
              "type": "COMMISSION"
            },
            {
              "identifier": "account-2",
              "identifierType": "INTERNAL",
              "amountDue": {
                "type": "PERCENTAGE",
                "percent": 0.8865
              },
              "type": "SALE"
            }
          ]
        }
      ]
    }
  ]
}
```

Объяснение:

Мы не будем здесь объяснять каждую точку данных, поскольку они уже описаны в документации API.

* Строки:**2 - 7**пользователь, ответственный за бронирование. Существует два типа бронирующих:
  * Путешественник.
  * Турагент.
* Строки:**8 - 9**учетная запись TripPay, облегчающая бронирование. Это может быть:
  * Ваш аккаунт интегратора TripPay.
  * Если вы управляете партнерской сетью, это может быть ваш партнер.
* Используйте`traceId`для группировки нескольких бронирований через нескольких поставщиков. Таким образом, вы можете отменить групповое бронирование.
* `redirectUrl`сообщает TripPay, на какую страницу перенаправлять после завершения платежа.
* `sourceUrl`сайт/приложение, на котором было совершено бронирование.

The`contractList`массив содержит товар(ы), которые путешественник хочет купить у нескольких поставщиков. Каждый товар содержит:

* The`identifier`— это действительный сгенерированный вами UUID.
* Поставщик, у которого вы хотите забронировать инвентарь.
* Инвентарь, который вы хотите забронировать у этого поставщика. Все они указаны во вложенном массиве`contractItemList`.
* Каждая запись под`contractItemList` содержит:
  * **Гость-пользователь**Это пользователь, который прибудет на объект.
  * **Имя на английском языке**Наименование инвентаря на английском языке.
  * **Описание на английском языке**Более подробное описание инвентаря на английском языке.
  * **Цена**Цена товара.
  * **Маршрут**Когда следует бронировать этот товар.
  * **Тип ценообразования**Как рассчитывалась цена.
  * **Тип инвентаря**Что это за тип инвентаря?
  * **Подлежащий оплате**Когда с путешественника следует взимать плату.*В настоящее время мы поддерживаем только варианты немедленной оплаты.*
  * **Политика**Включите правила отмены бронирования.
  * **Список ежедневных ставок**Если бронируется номер, вы можете указать стоимость каждой ночи проживания гостя в этом номере.
  * **Бенефициары**Укажите, на какой счет(а) TripPay следует начислить ту или иную сумму от стоимости товара.*Поддерживаются фиксированные/процентные суммы.*

:::note
В приведенном выше примере JSON у нас есть 3 бенефициара:

* 1,5% было выделено платформе, обеспечивающей бронирование.*например, Подмигивание*
* 9,85% было выделено филиалу в качестве комиссии.*например Ким Кардашьян*
* 88,65% было выделено поставщику на бронирование номера.*например, Хилтон*

Когда TripPay ответит платежным контрактом, вы заметите, что он ввел своего собственного бенефициара в размере 4,0%.
:::

### Ответ

Когда TripPay ответит на ваш запрос, это будет выглядеть примерно так:

```json {3}
[
  {
    "id": "contract-1",
    "traceId": "trace-1",
    "supplierContractIdentifier": "191d5729-0b90-4000-8298-72431beb1701",
    "supplierIdentifier": "191d5729-0b90-4000-8b72-58186a642401",
    "supplierName": "Hilton",
    "totalPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalDisplayPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalSupplierPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalInternalPrice": {
      "amount": 100,
      "currency": "USD"
    },
    "totalCapturePrice": {
      "amount": 100,
      "currency": "USD"
    }
  }
]
```

Сохранить`id`в строке 3. Вы будете использовать это для внедрения в веб-компонент TripPay.

## Встроить TripPay

:::note
Убедитесь, что вы заранее загрузили наши стили и Javascript.
:::

На этом этапе вы готовы встроить`Payment Web Component`на свой сайт и покажите его пользователю.

```html
<trip-pay id="contract-1"></trip-pay>
```

Что касается интеграции, то это все, что вам нужно сделать. Всю тяжелую работу с этого момента выполняет TripPay.

